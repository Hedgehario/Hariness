**プロジェクト名**: Hariness（ハリネス）  
**作成日**: 2025年12月18日  
**作成者**: 城田 航  
**対象**: 入力フォーム・Server Actions 引数・DB整合性（Supabase）

---

## 1. 概要

本ドキュメントは、Hariness における入力・更新データの検証ルールを体系的に定義した設計書です。

フロントエンド（FE）、バックエンド（BE）、データベース（DB）の3層で実施するバリデーションを、画面別・機能別に整理し、各レイヤでの責務分担と検証ルールを明確化します。また、エラーコード（`13_例外仕様書.md` 参照）との対応関係も定義します。

## 2. 目的

本ドキュメントの目的は以下の通りです：

1. **データ整合性の確保**: 不正なデータがデータベースに保存されることを防ぎ、システム全体の整合性を保ちます。
2. **優れたUXの実現**: ユーザーが入力ミスをした際に、その場で分かりやすいエラー提示を行うことで、操作の中断を最小限に抑えます。
3. **セキュリティの強化**: 不正入力や悪意のある攻撃（SQLインジェクション、XSS等）を未然に防ぎます。
4. **実装の一貫性**: 開発チーム全体で統一されたバリデーションルールを共有し、実装の一貫性を保ちます。

> **📚 関連ドキュメント**  
> - `12_API仕様書.md` - 型定義の詳細  
> - `13_例外仕様書.md` - エラーコード体系  
> - `11_ER図、テーブル定義書.md` - DB制約の詳細

---

## 3. 適用範囲と責務分担

### 3.1 用語説明

| 用語 | 説明 | 具体例 |
| :--- | :--- | :--- |
| **FE** | **Frontend（フロントエンド）** - ブラウザ上で動作するクライアント側のコード | React コンポーネント、Zod による入力検証 |
| **BE** | **Backend（バックエンド）** - サーバー側で動作するコード | Next.js Server Actions、Supabase クライアント |
| **DB** | **Database（データベース）** - データを永続化する層 | Supabase PostgreSQL、テーブル制約 |

### 3.2 検証レイヤ

| レイヤ                    | 目的                 | 主な手段                      | 失敗時                      |
| ---------------------- | ------------------ | ------------------------- | ------------------------ |
| **FE（クライアント）**         | UX向上 / 即時フィードバック   | Zod / 入力制御                | E001（VALIDATION_ERROR）相当 |
| **BE（Server Actions）** | 最終防衛線 / 画面文脈の業務ルール | Zod / 追加チェック              | E001 / E007 等            |
| **DB（Supabase）**       | 整合性保証 / 同時実行の最後の砦  | NOT NULL / CHECK / UNIQUE | E006（CONFLICT）等にマッピング    |

> **原則：**"FEは親切、BE/DBは厳格"  
> FEで通ってもBE/DBで落ちるのは許容（同時更新・改ざん対策）。

---

## 4. エラーコードとの対応

本設計書で定義するバリデーションエラーは、`13_例外仕様書.md` で定義されたエラーコード体系と対応します。

### 4.1 バリデーション関連エラーコード

| エラーコード | 発生条件 | 備考 |
| :--- | :--- | :--- |
| **E001** (`VALIDATION_ERROR`) | バリデーション失敗（入力値検証エラー） | 原則的なバリデーションエラー |
| **E002** (`AUTH_FAILED`) | 認証失敗（ログイン時） | 詳細理由は返却しない（列挙攻撃対策） |
| **E003** (`AUTH_REQUIRED`) | 未認証アクセス | 認証ガード（バリデーションというよりガード） |
| **E004** (`FORBIDDEN`) | 権限不足 | 管理者専用機能への一般ユーザーアクセス等 |
| **E006** (`CONFLICT`) | データ重複（DB制約違反） | UNIQUE制約違反等 |
| **E007** (`LIMIT_EXCEEDED`) | 業務ルール違反（登録上限超過等） | 例：個体登録数上限（10頭） |
| **E008-1** (`STORAGE_VALIDATION_ERROR`) | ファイル形式・サイズ不正 | 画像アップロード時の検証エラー |
| **E008-2** (`STORAGE_UPLOAD_ERROR`) | ファイル保存失敗 | ストレージ保存処理エラー |

### 4.2 バリデーション対象外だが関連するエラーコード

| エラーコード | 発生条件 | 備考 |
| :--- | :--- | :--- |
| **E901** (`NETWORK_ERROR`) | 通信エラー（オフライン、タイムアウト等） | クライアント側で検知。バリデーション対象外 |
| **E999** (`INTERNAL_SERVER_ERROR`) | 想定外のシステムエラー | バリデーション対象外。ログ出力して原因調査 |

> **📝 エラーレスポンス構造について**  
> Server Actions のエラーレスポンスは `ActionResponse` 型に従います。  
> 動的メッセージが必要な場合（例：E006）は、`error.meta` フィールドに補足情報を含め、UI側でテンプレートに埋め込みます。  
> **注意**: `error.details` は使用せず、`error.meta` を使用します。  
> 詳細は `13_例外仕様書.md` を参照してください。

---

## 5. 共通フォーマット規約

### 5.1 日付・時刻

| 種別 | 形式 | 例 | 備考 |
| :--- | :--- | :--- | :--- |
| 日付 | `YYYY-MM-DD` | `2025-12-18` | 通常の日付形式 |
| 日付（エクスポート用） | `YYYYMMDD` | `20251218` | `exportDataAsCsv` のみ |
| 時刻 | `HH:mm` または `HH:mm:ss` | `09:00` / `09:00:00` | どちらでも可 |
| 日時 | ISO 8601 | `2025-12-18T09:00:00Z` | 予約投稿等で使用 |

> **📝 詳細は [Appendix A.3](#a3-日付時刻形式一覧) を参照**

### 5.2 文字列

* 前後空白は **trim**（FE/BE）
* 改行許可はフィールドごとに明記

### 5.3 数値

* 数値型は **数値として解釈できること**（文字列数字は FE で変換可）
* 小数許容はフィールドごとに明記

---

## 6. 画面別バリデーション定義

> **📝 表の見方**  
> - **層**: `FE/BE/DB` のどこで担保するか（用語説明は [3.1](#31-用語説明) を参照）  
> - **エラー**: 発生時のエラーコード（`13_例外仕様書.md` 参照）  
> - **メッセージ（例）**: ユーザー向けメッセージの例（実際の文言は例外仕様書・画面定義に委譲）  
> 
> **原則**: "最低限"DB側で守るもの（整合性）は必ずDBに置きます。

---

### 6.1 認証（A01〜A08）

#### A02: 新規登録（`signUpAction` / `SignUpInput`）

| 項目          | ルール                  | 層     | エラー  | メッセージ（例）            | 備考                    |
| ----------- | -------------------- | ----- | ---- | ------------------- | --------------------- |
| email       | 必須 / メール形式           | FE+BE | E001 | メールアドレスの形式が正しくありません | Supabase Authに渡す前に落とす |
| password    | 必須 / 最小8文字 | FE+BE | E001 | パスワードが短すぎます         | Supabase Auth設定に準拠      |
| redirectUrl | 必須 / URL形式 + allowlist           | BE    | E001 | 不正なURLです            | open redirect対策。許可リスト（same-origin / 指定ドメイン）のみ許可<br>例：`https://hariness.app/**` または relative path |

#### A01: ログイン（`signInAction` / `SignInInput`）

| 項目       | ルール        | 層     | エラー  | メッセージ（例）             | 備考     |
| -------- | ---------- | ----- | ---- | -------------------- | ------ |
| email    | 必須 / メール形式 | FE+BE | E001 | メール形式が不正です           |        |
| password | 必須         | FE+BE | E001 | パスワードを入力してください       |        |
| 認証失敗     | 詳細理由は返さない  | BE    | E002 | メールアドレスまたはパスワードが違います | 列挙攻撃対策 |

#### A05: パスワードリセット送信（`resetPasswordAction`）

| 項目    | ルール        | 層     | エラー  | メッセージ（例）   | 備考                            |
| ----- | ---------- | ----- | ---- | ---------- | ----------------------------- |
| email | 必須 / メール形式 | FE+BE | E001 | メール形式が不正です | **存在有無はユーザーに伝えない**（アカウント列挙対策）。形式が正しい場合は、対象メールが存在しなくても success を返す（UIメッセージは共通） |

#### A06: パスワード更新（`updatePasswordAction`）

| 項目         | ルール                  | 層     | エラー  | メッセージ（例）        | 備考                    |
| ---------- | -------------------- | ----- | ---- | --------------- | --------------------- |
| newPassword | 必須 / 最小8文字 | FE+BE | E001 | パスワードが短すぎます     | Supabase Auth設定に準拠      |

---

### 6.2 飼い主プロフィール（A09, S10）

#### S10: プロフィール更新（`updateProfile` / `UpdateProfileInput`）

| 項目                  | ルール                    | 層     | エラー  | メッセージ（例）        | 備考                          |
| ------------------- | ---------------------- | ----- | ---- | --------------- | --------------------------- |
| displayName（ニックネーム） | **必須** / 1文字以上 / 最大50文字 | FE+BE | E001 | ニックネームを入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| avatarUrl           | 任意 / URL形式             | FE+BE | E001 | 画像URLが不正です      | 画像アップロード採用時は別扱い             |
| gender              | 任意 / 列挙値のみ             | FE+BE | E001 | 選択値が不正です        | 参照：[Appendix A.4.1](#a41-性別gender) |
| ageGroup            | 任意 / 列挙値のみ             | FE+BE | E001 | 選択値が不正です        | 参照：[Appendix A.4.3](#a43-年代agegroup) |
| prefecture          | 任意 / 列挙値のみ             | FE+BE | E001 | 選択値が不正です        | 都道府県＋海外（列挙値は別途定義） |

#### S11: 通知設定更新（`updateNotificationSettings` / `NotificationSettingsInput`）

> **📝 注意**  
> `NotificationSettingsInput` の各フィールド（`isPushEnabled`, `isReminderEnabled`, `isAlertEnabled`, `isNewsEnabled`）は、型定義書で `boolean` 型として定義されています。  
> 実行時の型チェックはZod等で `z.boolean()` により担保されますが、通常のユーザー操作ではエラーが発生しないため、本表では記載を省略します。

#### A09: 退会処理（`deleteAccount`）

| 項目     | ルール        | 層     | エラー  | メッセージ（例） | 備考 |
| ------ | ---------- | ----- | ---- | ---------- | -- |
| reason | 必須 / 最大500文字 | FE+BE | E001 | 退会理由を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |

---

### 6.3 個体管理（A10, P10）

**要件**: 個体は最大10頭、必須は名前のみ。

#### createHedgehog / updateHedgehog（`CreateHedgehogInput` / `UpdateHedgehogInput`）

| 項目              | ルール                               | 層     | エラー    | メッセージ（例）        | 備考                  |
| --------------- | --------------------------------- | ----- | ------ | --------------- | ------------------- |
| name            | **必須**（create）/ 任意（update）/ 最大50文字 | FE+BE | E001   | 名前を入力してください     | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| gender          | 任意 / 列挙値のみ                        | FE+BE | E001   | 選択値が不正です        | 参照：[Appendix A.4.1](#a41-性別gender) |
| birthDate       | 任意 / 日付形式 / 未来日不可                 | FE+BE | E001   | 生年月日が不正です       | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| welcomeDate     | 任意 / 日付形式 / 未来日不可                 | FE+BE | E001   | 迎えた日が不正です       | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| features        | 任意 / 最大200文字                        | FE+BE | E001   | 文字数が多すぎます       | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |
| insuranceNumber | 任意 / 最大50文字                        | FE+BE | E001   | 入力が不正です         | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| imageFile       | 任意 / 形式: jpg/png/webp / サイズ上限     | FE+BE | E008-1 | ファイル形式/サイズが不正です | ストレージ仕様と連動（例外仕様書側）  |
| 個体数上限           | **1ユーザー最大10頭**                    | BE+DB | E007   | 登録上限に達しています     | 競合対策でDB側も担保推奨       |

---

### 6.4 健康記録（R12: 日次記録一括保存）

**要件**: 食事は30文字まで。体重・環境は同日1件のみ。

#### saveDailyBatch（`DailyRecordBatchInput`）

##### 共通パラメータ

| 項目         | ルール                  | 層     | エラー  | メッセージ（例） | 備考                  |
| ---------- | -------------------- | ----- | ---- | ---------- | ------------------- |
| hedgehogId | 必須 / UUID形式 | BE    | E001 |            | Supabase の UUID 形式。ID仕様が変わる場合は本ドキュメントを改訂する。他ユーザーの個体を弾く（RLS/BE） |
| date       | 必須 / 日付形式            | FE+BE | E001 | 日付を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |

##### 体重・環境記録

| 項目                 | ルール                                | 層     | エラー  | メッセージ（例）         | 備考 |
| ------------------ | ---------------------------------- | ----- | ---- | ---------------- | -- |
| weight             | 任意 / 数値のみ / 範囲（0 < weight < 3000） | FE+BE | E001 | 体重の入力が不正です       | 参照：[Appendix A.2](#a2-数値レンジ一覧) |
| temperature        | 任意 / 数値 / 範囲（-10〜50）             | FE+BE | E001 | 気温の入力が不正です       | 参照：[Appendix A.2](#a2-数値レンジ一覧) |
| humidity           | 任意 / 数値 / 範囲（0〜100）              | FE+BE | E001 | 湿度の入力が不正です       | 参照：[Appendix A.2](#a2-数値レンジ一覧) |
| 環境記録の必須条件           | **環境記録として保存する場合**は、temperature と humidity の**少なくともどちらか必須** | FE+BE | E001 | 気温または湿度を入力してください | どちらも空なら環境レコードを作らない（UX寄り：ユーザーは未入力のまま保存可能） |
| 同日重複チェック           | **体重・環境は同日1件のみ**                    | BE+DB | E006   | 同じ日に既に記録があります       | `UNIQUE(hedgehog_id, record_date)` でDB制約 |

##### 食事記録（meals）

| 項目         | ルール             | 層     | エラー  | メッセージ（例） | 備考           |
| ---------- | --------------- | ----- | ---- | ---------- | ------------ |
| time       | 必須 / 時刻形式       | FE+BE | E001 | 時刻を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| content    | 必須 / **最大30文字** | FE+BE | E001 | 食事内容を入力してください（30文字まで） | **要件で明確**（参照：[Appendix A.1](#a1-文字数上限一覧)） |
| amount     | 任意 / 数値 / 0以上   | FE+BE | E001 | 量の入力が不正です | 参照：[Appendix A.2](#a2-数値レンジ一覧) |
| amountUnit | amount入力時は必須    | FE+BE | E001 | 単位を入力してください | `'g'`, `'スプーン'` 等 |
| id         | 更新時のみ必須         | BE    | E001 |            | 一括更新の整合性担保   |

##### 排泄記録（excretions）

| 項目        | ルール                        | 層     | エラー  | メッセージ（例） | 備考 |
| --------- | -------------------------- | ----- | ---- | ---------- | -- |
| time      | 必須 / 時刻形式                  | FE+BE | E001 | 時刻を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| condition | 必須 / 列挙値のみ             | FE+BE | E001 | 状態を選択してください | 参照：[Appendix A.4.2](#a42-排泄状態condition) |
| details   | condition=異常 のとき必須 / 最大200文字 | FE+BE | E001 | 詳細を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |

##### 投薬記録（medications）

| 項目   | ルール        | 層     | エラー  | メッセージ（例） | 備考 |
| ---- | ---------- | ----- | ---- | ---------- | -- |
| time | 必須 / 時刻形式  | FE+BE | E001 | 時刻を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| name | 必須 / 最大50文字 | FE+BE | E001 | 薬の名前を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| id   | 更新時のみ必須    | BE    | E001 |            | 一括更新の整合性担保 |

##### メモ（memo）

| 項目   | ルール        | 層     | エラー  | メッセージ（例） | 備考      |
| ---- | ---------- | ----- | ---- | ---------- | ------- |
| memo | 任意 / 最大1000文字 | FE+BE | E001 | 文字数が多すぎます | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |

> **⚠️ 一括保存の削除ロジック**  
> 「送られてこなかった既存IDを削除する」方式は強い一方、**不正な欠落**で消えるリスクがあるため、BE側で以下のチェックを必須にします：
> 
> - “対象日データの取得→差分計算→削除” の前に **hedgehogId/date の所有チェック**を必須にする（RLS/BE）
> - 画面構造：R12は食事/排泄の複数追加・削除があるため、この方式は自然

---

### 6.5 通院記録（V10）

**要件**: テキスト入力のみ、処方薬は複数可。

#### saveHospitalVisit（`HospitalVisitInput`）

| 項目                   | ルール                       | 層     | エラー  | メッセージ（例） | 備考          |
| -------------------- | ------------------------- | ----- | ---- | ---------- | ----------- |
| hedgehogId           | 必須 / UUID形式                        | BE    | E001 |            | Supabase の UUID 形式。ID仕様が変わる場合は本ドキュメントを改訂する。他ユーザーの個体を弾く（RLS/BE） |
| visitDate            | 必須 / 日付形式                 | FE+BE | E001 | 通院日を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| diagnosis            | 任意 / 最大500文字                | FE+BE | E001 | 文字数が多すぎます | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |
| treatment            | 任意 / 最大1000文字                | FE+BE | E001 | 文字数が多すぎます | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |
| medicinePrescription | 任意 / 配列可                  | FE+BE | E001 |            | 複数登録可       |
| medicinePrescription[].name | 必須 / 最大50文字 | FE+BE | E001 | 薬の名前を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| medicinePrescription[].note | 任意 / 最大200文字 | FE+BE | E001 | 文字数が多すぎます | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| nextVisitDate        | 任意 / 日付形式 / visitDate以降推奨 | FE+BE | E001 | 次回診察日が不正です | 参照：[Appendix A.3](#a3-日付時刻形式一覧)。“推奨”は警告扱いも可 |

---

### 6.6 カレンダー（C11）

#### saveCalendarEvent（`CalendarEventInput`）

| 項目    | ルール        | 層     | エラー  | メッセージ（例） | 備考 |
| ----- | ---------- | ----- | ---- | ---------- | -- |
| date  | 必須 / 日付形式  | FE+BE | E001 | 日付を選択してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| title | 必須 / 最大100文字 | FE+BE | E001 | イベント名を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |

---

### 6.7 リマインダー（H12）

**要件**: 繰り返し：毎日/曜日指定、時刻等。

#### saveReminder（`CareReminderInput`）

| 項目         | ルール                                   | 層     | エラー  | メッセージ（例） | 備考         |
| ---------- | ------------------------------------- | ----- | ---- | ---------- | ---------- |
| title      | 必須 / 最大50文字                            | FE+BE | E001 | タイトルを入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| targetTime | 必須 / 時刻形式                             | FE+BE | E001 | 時刻を入力してください | 参照：[Appendix A.3](#a3-日付時刻形式一覧) |
| frequency  | isRepeat=true のとき必須 / daily or weekly | FE+BE | E001 | 繰り返し頻度を選択してください | 参照：[Appendix A.4.4](#a44-リマインダー頻度frequency)。`isRepeat` は型定義書で `boolean` 型として定義されているため、本表では記載を省略 |
| daysOfWeek | frequency=weekly のとき必須 / 配列（Mon..Sun） | FE+BE | E001 | 曜日を選択してください | 参照：[Appendix A.4.5](#a45-曜日daysofweek)。DB保存形式：text型で `"Mon,Wed"`（カンマ区切り文字列） |

---

### 6.8 管理者（ADM10, ADM20）

**要件**: エクスポート画面のUI/フローは `10_管理者用機能データエクスポート仕様書.md` を参照。

#### exportDataAsCsv

| 項目                | ルール                        | 層     | エラー  | メッセージ（例） | 備考           |
| ----------------- | -------------------------- | ----- | ---- | ---------- | ------------ |
| types             | 必須 / 1件以上                  | FE+BE | E001 | エクスポート種別を選択してください | 0件ならメッセージで誘導 |
| startDate         | 必須 / 形式 `YYYYMMDD` / start<=end | FE+BE | E001 | 開始日を入力してください | **通常の日付形式（YYYY-MM-DD）とは異なる**（参照：[Appendix A.3](#a3-日付時刻形式一覧)） |
| endDate           | 必須 / 形式 `YYYYMMDD` / start<=end | FE+BE | E001 | 終了日を入力してください | **通常の日付形式（YYYY-MM-DD）とは異なる**（参照：[Appendix A.3](#a3-日付時刻形式一覧)） |
| 権限                | adminのみ                    | BE+DB | E004 | この操作を行う権限がありません | RLS/BEで担保    |

#### createNews（管理者）

| 項目          | ルール        | 層     | エラー  | メッセージ（例） | 備考   |
| ----------- | ---------- | ----- | ---- | ---------- | ---- |
| title       | 必須 / 最大200文字 | FE+BE | E001 | タイトルを入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧) |
| content     | 必須 / 最大5000文字 | FE+BE | E001 | 内容を入力してください | 参照：[Appendix A.1](#a1-文字数上限一覧)。改行可 |
| publishedAt | 任意 / ISO形式 | FE+BE | E001 | 公開日時の形式が不正です | 参照：[Appendix A.3](#a3-日付時刻形式一覧）。`isPublished` は型定義書で `boolean` 型として定義されているため、本表では記載を省略 |

---

## 7. DB制約（推奨）

> **📝 注意**  
> ここは"設計書として完成度が上がる"ので、最低限だけ明記しておくのが良いです。  
> 詳細は `11_ER図、テーブル定義書.md` を参照してください。

### 7.1 必須制約（NOT NULL）

* `hedgehogs.user_id` は必須（RLS前提）
* `users.email` は必須
* 各記録テーブルの `hedgehog_id`, `record_date` は必須

### 7.2 一意制約（UNIQUE）

* **体重記録**: `UNIQUE(hedgehog_id, record_date)` → **E006（CONFLICT）**へマッピング
* **環境記録**: `UNIQUE(hedgehog_id, record_date)` → **E006（CONFLICT）**へマッピング
* `users.email` は一意（Supabase Auth側で担保）

### 7.3 業務ルール制約

* **個体数上限（10頭）**: BEチェック + DB側でも担保推奨（同時実行対策） → **E007（LIMIT_EXCEEDED）**へマッピング
  * 実装例：DB側で `CHECK` 制約またはトリガーで検証

### 7.4 外部キー制約

* 各テーブルの外部キーは `ON DELETE CASCADE` で設定（詳細はER図参照）

---

## 8. メッセージ設計（この設計書の方針）

* この文書では **文言は例**に留め、実運用は
  * **例外仕様書**（`13_例外仕様書.md`）の E001/E006… に委譲
  * **画面定義**（表示位置・形式）に委譲
* 動的メッセージが必要なもの（例：E006）は `error.meta` で補足し、UI側でテンプレートに埋め込む（例外仕様書の方針と一致）。
  * **注意**: `ActionResponse` の `error.details` は使用せず、`error.meta` を使用します。

---

## Appendix A: 共通制約一覧

本 Appendix では、各画面のバリデーション定義で参照する共通制約を一覧化します。  
各画面の表では「参照：Appendix A」と記載し、詳細は本 Appendix を参照してください。

### A.1 文字数上限一覧

| 項目 | 推奨値 | 備考 |
| :--- | :--- | :--- |
| ニックネーム（displayName） | 50文字 | UI基準 |
| 個体名（name） | 50文字 | UI基準 |
| 特徴（features） | 200文字 | UI基準 |
| 食事内容（content） | **30文字** | **要件で明確** |
| 薬の名前（medicineName） | 50文字 | UI基準 |
| メモ（memo） | 1000文字 | UI基準 |
| 退会理由（reason） | 500文字 | UI基準 |
| 診断名（diagnosis） | 500文字 | UI基準 |
| 治療内容（treatment） | 1000文字 | UI基準 |
| イベント名（title） | 100文字 | UI基準 |
| リマインダータイトル（title） | 50文字 | UI基準 |
| お知らせタイトル（title） | 200文字 | UI基準 |
| お知らせ内容（content） | 5000文字 | UI基準 |

> **📝 決め方**  
> - **UI基準で決めて要件に追記**（推奨）  
> - もしくは DBの `varchar(n)` で決めて仕様に寄せる

### A.2 数値レンジ一覧

| 項目 | 推奨値 | 備考 |
| :--- | :--- | :--- |
| 体重（weight） | 0 < weight < 3000 | 単位：g（整数） |
| 気温（temperature） | -10 〜 50 | 単位：℃（小数許容） |
| 湿度（humidity） | 0 〜 100 | 単位：%（小数許容） |
| 量（amount） | 0 以上 | 小数許容 |

### A.3 日付・時刻形式一覧

| 種別 | 形式 | 例 | 備考 |
| :--- | :--- | :--- | :--- |
| 日付 | `YYYY-MM-DD` | `2025-12-18` | 通常の日付形式 |
| 日付（エクスポート用） | `YYYYMMDD` | `20251218` | `exportDataAsCsv` のみ |
| 時刻 | `HH:mm` または `HH:mm:ss` | `09:00` / `09:00:00` | どちらでも可 |
| 日時 | ISO 8601 | `2025-12-18T09:00:00Z` | 予約投稿等で使用 |

### A.4 列挙値（Enum）一覧

#### A.4.1 性別（gender）

> **📝 適用範囲**  
> Harinessでは、**プロフィール（user）と個体（hedgehog）で gender は共通の列挙値に統一**します。  
> DB保存値は英語enum、UI表示は日本語に変換します。

| DB保存値 | UI表示（共通） | 備考 |
| :--- | :--- | :--- |
| `'male'` | 男性 | 個体画面では「オス」表記に変換してもよい（表示レイヤの責務） |
| `'female'` | 女性 | 個体画面では「メス」表記に変換してもよい（表示レイヤの責務） |
| `'unknown'` | 不明 | 個体・プロフィール共通 |

#### A.4.2 排泄状態（condition）

| DB保存値 | UI表示 | 備考 |
| :--- | :--- | :--- |
| `'normal'` | 正常 | |
| `'abnormal'` | 異常 | |

#### A.4.3 年代（ageGroup）

| DB保存値 | UI表示 | 備考 |
| :--- | :--- | :--- |
| `'10s'` | 10代 | |
| `'20s'` | 20代 | |
| `'30s'` | 30代 | |
| `'40s'` | 40代 | |
| `'50s'` | 50代 | |
| `'60_over'` | 60代以上 | |

#### A.4.4 リマインダー頻度（frequency）

| DB保存値 | UI表示 | 備考 |
| :--- | :--- | :--- |
| `'daily'` | 毎日 | |
| `'weekly'` | 週次 | |

#### A.4.5 曜日（daysOfWeek）

| DB保存値 | UI表示 | 備考 |
| :--- | :--- | :--- |
| `'Mon'` | 月曜日 | |
| `'Tue'` | 火曜日 | |
| `'Wed'` | 水曜日 | |
| `'Thu'` | 木曜日 | |
| `'Fri'` | 金曜日 | |
| `'Sat'` | 土曜日 | |
| `'Sun'` | 日曜日 | |

> **📝 DB保存形式**  
> - **DB型**: `text`  
> - **保存形式**: カンマ区切り文字列（例：`"Mon,Wed"`）  
> - **入力形式**: 配列（例：`["Mon", "Wed"]`）を保存時に文字列に変換

> **📝 列挙値の方針**  
> - **DB保存値**は英語で固定（enum型推奨）  
> - **UI表示**は別途定義（i18n/表示変換）  
> - これにより、将来の多言語対応や表示変更に対応しやすくなります

---

## Appendix B: 設計書の更新ルール

本設計書の保守性を保つため、以下の更新ルールを定めます。

### B.1 更新が必要なタイミング

| 更新タイミング | 更新箇所 | 備考 |
| :--- | :--- | :--- |
| Appendix A.1 の推奨値が変更された場合 | [A.1 文字数上限一覧](#a1-文字数上限一覧) | 各画面の表の「参照：Appendix A.1」リンクで整合性を確認 |
| Appendix A.2 の推奨値が変更された場合 | [A.2 数値レンジ一覧](#a2-数値レンジ一覧) | 各画面の表の「参照：Appendix A.2」リンクで整合性を確認 |
| Appendix A.3 の形式が変更された場合 | [A.3 日付・時刻形式一覧](#a3-日付時刻形式一覧) | 各画面の表の「参照：Appendix A.3」リンクで整合性を確認 |
| Appendix A.4 の列挙値が変更された場合 | Appendix A.4 列挙値（Enum）一覧（目視で確認） | 各画面の表の「参照：Appendix A.4.x」リンクで整合性を確認 |
| ID形式（UUID等）が変更された場合 | 該当する画面の表の備考欄 | 例：`hedgehogId` の備考欄を更新 |
| エラーコード体系が変更された場合 | [2. エラーコードとの対応](#2-エラーコードとの対応) | 各画面の表のエラーコード列も確認 |

### B.2 更新時の注意事項

* Appendix の値を変更した場合は、必ず各画面の表との整合性を確認する
* 列挙値（Enum）を追加・変更した場合は、DB保存値とUI表示の両方を更新する
* ID形式を変更した場合は、該当するすべての画面の表を確認する

---

---

**最終更新日**: 2025年12月18日
