**プロジェクト名**: Hariness（ハリネス）  
**作成日**: 2025年12月18日  
**更新日**: 2026年1月20日  
**作成者**: 城田 航

## 1. 選定技術スタック

**全体の構成**: Next.js + Supabase + Vercel

| 区分           | 選定技術     | 理由                                                                |
| -------------- | ------------ | ------------------------------------------------------------------- |
| フロントエンド | **Next.js**  | PWA対応の容易さとVercelでの高速なデプロイ・動作                     |
| バックエンド   | **Supabase** | 複雑なリレーションデータ（多頭飼い・記録）に適したRDBと認証基盤     |
| インフラ       | **Vercel**   | Next.jsに最適化されており、個人開発のインフラ管理コストをゼロにする |

### 主要UIライブラリ

| ライブラリ | 用途 |
| ---------- | ---- |
| **framer-motion** | スワイプタブ、アニメーション |
| **vaul** | モバイル向けDrawer/ボトムシート |
| **recharts** | 体重グラフの描画 |
| **react-day-picker** | カレンダーUI |
| **Radix UI** | アクセシブルなUIプリミティブ（Dialog, Select, Switch等） |

---

## 2. 選定の前提条件（要件と制約）

技術選定にあたり、本プロダクト特有の「事業要件」と「技術要件」を以下のように定義しました。これらが選定の判断基準（軸）となります。

### 2.1 事業要件（お財布・時間・リソース）

- **個人開発・短納期**: 初期版リリースに向け、インフラ構築やボイラープレート作成に時間を割かず、「機能開発」に全リソースを集中する必要がある。
- **ランニングコスト**: 個人運用のため、可能な限り「固定費ゼロ」でスタートしたい。
- **アプリストア審査の回避**: iOS/Androidの両ストアへの公開・審査対応は工数・コスト（登録料）的に厳しいため、Webベースでアプリのような体験を提供したい。

### 2.2 技術要件（プロダクト特性）

- **複雑なデータ構造**: 「飼い主 1 : 多 個体 : 多 記録」というリレーショナルなデータ構造を持つため、整合性の担保が重要。
- **モバイルファースト (PWA)**: 飼い主がケージの前で片手で操作するため、ネイティブアプリに近いUI/UXとホーム画面追加が必要。
- **外部サービス連携**: 協会提供のGoogleマイマップ埋め込みなど、Web標準技術との親和性が求められる。

---

## 3. 詳細な選定理由と比較検討

### 3.1 フロントエンド: Next.js

#### 比較検討した技術

| 技術                       | 評価       | 採用/不採用の理由                                                                                                                             |
| :------------------------- | :--------- | :-------------------------------------------------------------------------------------------------------------------------------------------- |
| **Next.js (App Router)**   | **◎ 採用** | **PWA化が容易 (`next-pwa`) であり、Vercel連携によりデプロイ工数が皆無。** Reactのエコシステムをフル活用できる。                               |
| **React Native / Flutter** | △ 不採用   | ネイティブアプリとして最高品質だが、**ストア審査が必要**になり納期・コスト要件に合わない。Googleマップ埋め込み等のWeb資産活用も少し手間取る。 |
| **Pure React (Vite/CRA)**  | ◯ 候補     | 軽量で良いが、ルーティングや画像最適化などを個別に選定・設定する手間がある。Next.jsのオールインワンな環境の方が初速が出る。                   |

#### 選定の決め手

1.  **PWA対応の容易さ**:
    - 要件である「ストアを通さずにアプリのような体験を提供する」ためにPWAは必須。Next.jsエコシステムには `next-pwa` などの知見が豊富にあり、マニフェスト設定やService Worker導入がスムーズに行える。
2.  **Vercelとの親和性 (DevOps)**:
    - 「個人開発・短納期」の制約下では、デプロイパイプラインの構築に時間を割けない。Next.jsであればVercelにPushするだけで最適化された環境が手に入る。
3.  **App Router (Server Components)**:
    - 初期ロードの速さはモバイル利用時のUXに直結する。Server Componentsによりバンドルサイズを抑制できる点は、回線環境が不安定になりがちな外出先（病院など）での利用にも有利。

---

### 3.2 バックエンド: Supabase

#### 比較検討した技術

| 技術                               | 評価       | 採用/不採用の理由                                                                                                                                        |
| :--------------------------------- | :--------- | :------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Supabase**                       | **◎ 採用** | **PostgreSQLベースのため、今回の「飼い主-個体-記録」というリレーショナルなデータ構造に最適。** Auth/Storageも完備。                                      |
| **Firebase**                       | △ 不採用   | NoSQL (Firestore) はスキーマレスで柔軟だが、多対多のリレーションや複雑な集計（グラフ表示用データ抽出など）を行う際にクエリが複雑化・非効率になりやすい。 |
| **フルスクラッチ (Go/Node + RDB)** | ✕ 不採用   | 柔軟性は最強だが、認証基盤やAPIサーバーの構築・保守に膨大な時間がかかり、今回の「短納期」要件において致命的。                                            |

#### 選定の決め手

1.  **データ構造との相性 (RDB vs NoSQL)**:
    - 本アプリは「ユーザーが複数の個体を持ち、各個体が複数の記録を持つ」という典型的なリレーショナル構造。加えて「協会用データ分析」でSQLによる集計も視野に入れているため、NoSQLのFirebaseよりもPostgreSQLベースのSupabaseが圧倒的に適している。
2.  **セキュリティ実装の工数削減 (RLS)**:
    - 「ユーザーは自分のペットのデータしか見れない」というアクセス制御を、アプリケーションコードではなくDB側 (Row Level Security) で担保できる。これにより実装ミスによる情報漏洩リスクを低減できる。
3.  **TechTrainでの学習資産**:
    - 学習済みのSQL/RDB技術をそのまま活かせるため、学習コストを最小化できる。

---

### 3.3 インフラ: Vercel

#### 比較検討した技術

| 技術                  | 評価       | 採用/不採用の理由                                                                                                                                            |
| :-------------------- | :--------- | :----------------------------------------------------------------------------------------------------------------------------------------------------------- |
| **Vercel**            | **◎ 採用** | **Next.jsの開発元であり最適解。** 設定不要でCI/CD、画像最適化、エッジキャッシュが手に入る。                                                                  |
| **AWS (EC2/Amplify)** | △ 不採用   | 構成の自由度は高いが、ネットワーク設定やインスタンス管理などのインフラ構築作業が発生する。「機能開発に集中する」という目的に対してオーバーエンジニアリング。 |
| **VPS (ConoHa等)**    | ✕ 不採用   | サーバーOSの管理、セキュリティパッチ当てなどの運用コスト（時間）が発生するため、個人開発の運用フェーズで負担になる。                                         |

#### 選定の決め手

1.  **開発体験と速度**:
    - Git連携するだけでプレビュー環境が自動生成される体験は、開発スピードを最大化する。
2.  **コストパフォーマンス**:
    - 個人規模のアクセス数であれば無料枠（Hobbyプラン）で十分な性能が得られ、ランニングコストゼロの要件を満たす。

---

## 4. 技術スタックの組み合わせによる恩恵

### 4.1 開発効率の最大化

- **Next.js × Vercel**: インフラ設定を意識せず、コードを書くことだけに集中できる環境。
- **Next.js × Supabase**: `supabase-js` や `ssr` パッケージにより、型安全なデータアクセスを簡単に実装可能。

### 4.2 将来の拡張性（スケーラビリティ）

- **「小さく始めて大きく育てる」**: 全て無料枠から開始でき、ユーザー数が増加した際もプラン変更のみで対応可能。
- **ポータビリティ**: Supabaseの中身は標準的なPostgreSQLであるため、将来的に特定のクラウドベンダーへ移行が必要になった際も、Firebase等の独自NoSQLに比べてロックインリスクが低い。

---

## 5. まとめ

**「個人開発のリソース制約」と「リレーショナルなデータ構造」に最適な組み合わせ**

| 要件                           | 解決策                      |
| :----------------------------- | :-------------------------- |
| **ストア審査なしでアプリ提供** | → **Next.js (PWA)**         |
| **複雑なデータ管理と分析**     | → **Supabase (PostgreSQL)** |
| **インフラ管理コストゼロ**     | → **Vercel**                |

このスタック選定により、限られた時間とリソースの中で、品質の高いアプリケーションを確実にデリバリーすることを目指します。
