## 1. 概要
- **プロジェクト名**：ハリネズミ健康管理アプリ『Hariness（ハリネス）』
- **プロダクト概要**：ハリネズミの飼い主がスマートフォンで簡単に健康状態や日々の記録を行え、日本ハリネズミ協会 ™ 管理者が記録された匿名データを閲覧・分析できる PWA 対応アプリ
- **作成日**：2025 年 9 月 4 日
- **作成者**：城田 航
- **目的**：
  - 入門編で整理した要求をもとに、要件を明文化し、設計・実装に着手できる状態にする。

---

## 2. 背景と目的
- このプロダクトを企画した理由や、現在の課題：
  1. 飼い主によるハリネズミの健康管理が手書きや記憶に頼ったアナログな方法に留まりやすく、情報整理や継続が困難
  2. 多頭飼いの場合、個体ごとの管理が複雑で継続が困難
  3. 日本ハリネズミ協会 ™ 側では飼育実態の詳細なデータが集まらず、知見や統計的な分析が進みにくい状況が続いている

- このプロダクトで実現したいこと：
  1. 飼い主による日々の健康管理の負担を軽減し、見える化する
  2. ハリネズミの飼育実態を定量的に把握し、協会活動の質を向上させる

---

## 3. 要求から要件への変換
| 区分     | 要求（入門編）                                                           | 要件（今回作成）                                                                                                                                                                                                                                       |
| -------- | ------------------------------------------------------------------------ | ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------ |
| 機能 1   | 飼い主が個体情報を管理したい                                             | 名前・写真・性別・生年月日・迎えた日・見た目の特徴・ペット保険番号を登録/編集/削除可能。最大 10 頭まで管理。一覧表示で個体を選択可能。必須入力は名前のみ、他は任意                                                                                                                             |
| 機能 2   | 健康情報（体重・食事など）を記録したい                                   | 体重は数値入力、自動グラフ化。食事はテキスト入力（30 文字まで）＋量（数値＋単位選択）＋履歴表示。排泄状態・気温・湿度・投薬状況も記録可能                                                                                                                                         |
| 機能 3   | 通院記録を残したい                                                       | 日付・診断名・治療内容・処方されたお薬・次回診察日などをテキストで記録、履歴閲覧可能（写真・PDF 添付は対象外）                                                                                                                                                         |
| 機能 4   | 投薬や掃除を忘れないようにしたい                                         | タイトル・日付・時刻・繰り返し設定が可能。リマインダーとして画面表示またはプッシュ通知（P1）で通知。通知の有効/無効は設定で切り替え可能                                                                                                                                                   |
| 機能 5   | 健康状態の異常を早期に発見したい                                         | 記録されたデータを分析し、体重増減異常・食事回数低下・排泄状態異常・温度・湿度異常などを検知。ホーム画面にアラート表示またはプッシュ通知（P1）で通知し、通知画面（🔔）にも履歴を表示する。通知の有効/無効は設定で切り替え可能（検知ルールは簡易的なものに限定）                                   |
| 機能 6   | 協会側に集まったデータを分析・研究に活用できるようにしたい               | 協会管理者向けにデータ閲覧・集計・CSV 出力機能を提供。管理画面にログインし、期間や条件を指定してデータを閲覧・分析可能（統計処理や研究利用は協会の運用に依存）                                                                                         |
| 機能 7   | 過去の記録を振り返りたい                                                 | カレンダー形式で個体の誕生日、通院日、記録した内容（食事、排泄状況など）を表示。日付をタップして詳細を確認可能（未来の予定として、日付とイベント名（自由記述）を登録。）                                                                                                               |
| 機能 8   | 近くの病院を素早く探したい                                               | 協会提供の Google マイマップを埋め込み表示し、病院情報を地図上で確認可能（外部サービス（Google マイマップ）の仕様に依存）                                                                                                                              |
| 機能 9   | アプリのアップデート情報やアラート履歴を確認したい                                     | ホーム画面ヘッダーの通知アイコン（🔔）から通知一覧画面にアクセス可能。アプリのアップデート情報やアラート履歴を閲覧可能                                                                                                                                |
| 機能 10  | 病院情報を提供したい、協会HP・Instagramやお問い合わせ先にアクセスしたい   | マップ画面から情報提供フォーム（Google フォーム）、ホーム画面下部から協会HPリンク、協会Instagramリンク、お問い合わせ先画面にアクセス可能。外部リンクは外部ブラウザまたは外部アプリで開く                                        |
| 機能 11  | アプリの設定を変更したい                                                 | ホーム画面ヘッダーの設定アイコン（⚙）から設定画面にアクセス可能。飼い主プロフィール編集、通知設定、利用規約・プライバシーポリシー確認、ログアウト、退会処理が可能                                                                                    |
| 非機能 1 | ユーザー認証、行レベルセキュリティ（RLS）、個人情報の適切な保護          | Supabase Auth（メール＋パスワード認証）による認証、RLS でデータ分離、個人情報の適切な保護。通信は HTTPS 必須                                                                                                                                           |
| 非機能 2 | 24 時間 365 日の稼働、99%以上の稼働率                                    | 24 時間 365 日の稼働、99%以上の稼働率を目指す                                                                                                                                                                                                          |
| 非機能 3 | モバイルファースト UI、直感的な操作、見やすいデザイン                    | モバイルファースト UI、直感的な操作、見やすいデザイン                                                                                                                                                                                                  |
| 非機能 4 | ページ表示 2 秒以内、画像読み込み 3 秒以内                               | ページ表示：初回ロード時 3 秒以内、ページ遷移時 1 秒以内を目標。画像読み込み：3 秒以内（画像最適化・遅延読み込みを前提）。データ取得を含む操作：3 秒以内を目標。ネットワーク環境によっては目標値を下回る場合あり、大量データの集計・分析画面は別途検討 |
| 非機能 5 | PWA 対応、レスポンシブ対応（スマホ・タブレット・PC）、運用マニュアル提供 | PWA 対応、レスポンシブ対応（スマホ・タブレット・PC）、運用マニュアル提供                                                                                                                                                                               |
| 非機能 6 | Supabase 無料枠内での運用、自動バックアップ、可能な限り無料での運用      | Supabase 無料枠内での運用、自動バックアップ利用、可能な限り無料での運用                                                                                                                                                                                |

---

## 4. 機能要件

- **機能 1：個体管理**
  - 概要：飼い主が飼育しているハリネズミの個体情報を管理
  - 詳細仕様：名前・写真・性別・生年月日・迎えた日・見た目の特徴・ペット保険番号を登録/編集/削除。最大 10 頭まで管理可能
  - 入出力条件：入力＝フォーム、出力＝一覧表示・個体詳細画面
  - 例外・制約：必須入力は名前のみ、他は任意

- **機能 2：健康記録**
  - 概要：体重・食事・排泄状態・気温・湿度・投薬状況・メモなどの記録
  - 詳細仕様：体重・気温・湿度は数値＋自動グラフ化（**スクロール式・非圧縮・折れ線**）、食事はテキスト入力＋量（数値＋単位選択）、排泄状態・投薬状況・メモ（自由記述）も記録可能
  - 入出力条件：入力＝記録フォーム、出力＝履歴一覧＋体重・気温・湿度グラフ（**折れ線グラフ**、**30日/90日/180日/範囲指定**）
  - 例外・制約：体重は数値のみ、食事は 30 文字まで

- **機能 3：通院・治療記録**
  - 概要：診療記録の保存と参照
  - 詳細仕様：日付・診断名・治療内容・処方されたお薬・次回診察日などをテキスト（処方薬はリスト形式）で記録
  - 入出力条件：入力＝フォーム、出力＝通院履歴リスト
  - 例外・制約：テキスト入力のみ（写真・PDF 添付は対象外）、処方薬は複数登録可能

- **機能 4：お世話リマインダー**
  - 概要：掃除・投薬・給餌などをリマインド
  - 詳細仕様：
    - **一覧表示**：時刻順に自動ソート。完了した項目はグレーアウト＋取り消し線で表示。完了状態は翌日 0:00 にリセットされる。通知設定がOFFの場合、許可を促すアラートを表示。
    - **登録・編集**：タイトル・日付・時刻の設定。繰り返し設定は「毎日」「曜日指定」から選択可能。編集時のみ削除ボタンを表示。
    - **繰り返しOFF（1回のみ）**：完了操作を行った翌日、自動的に有効フラグをOFFにする。
    - **通知**：画面表示またはプッシュ通知（P1）。通知の有効/無効は設定画面で切り替え可能。
  - 入出力条件：入力＝設定画面（完了操作含む）、出力＝リマインダー表示（画面上またはプッシュ通知）
  - 例外・制約：プッシュ通知の有効/無効は設定画面で管理。ブラウザの通知許可が必要。

- **機能 5：アラート機能**
  - 概要：記録された健康データを分析し、異常を検知した際に画面アラートまたはプッシュ通知（P1）で通知
  - 詳細仕様：体重増減異常、食事回数低下、排泄状態異常、温度・湿度異常などを検知し、ホーム画面にアラート表示、プッシュ通知でも通知（P1）。また、通知画面（🔔）にアラート履歴を保存・表示する。通知の有効/無効は設定画面で切り替え可能
  - 入出力条件：入力＝健康記録データ、出力＝画面アラート表示、通知履歴保存、またはプッシュ通知
  - 例外・制約：検知ルールは簡易的なものに限定。プッシュ通知の有効/無効は設定画面で管理

- **機能 6：協会（管理者）用データ閲覧機能**
  - 概要：協会が収集したデータを研究・分析用に活用できる仕組み
  - 詳細仕様：管理者ログイン時のみアクセス可能なダッシュボードを提供。期間・データ種別（ユーザー/個体/記録）を指定してCSV形式でデータをエクスポート可能。プライバシー保護のため、個人を特定できる情報は除外または匿名化して出力する
  - 入出力条件：入力＝期間・データ種別指定、出力＝CSVファイルダウンロード
  - 例外・制約：アプリ上での高度なグラフ分析機能は実装せず、外部ツールでの分析を前提とする。管理者権限を持つユーザーのみ利用可能

- **機能 7：カレンダー機能**
  - 概要：過去の記録の振り返りおよび、今後の予定管理（イベント登録）
  - 詳細仕様：個体の誕生日、通院日、次回診察日、登録したイベントを表示。日付をタップして詳細確認が可能。また、ユーザーが任意の日付にイベント（タイトル自由記述）を登録・編集・削除できる。（食事や排泄などの詳細はカレンダーには紐付けない。）
  - 入出力条件：入力＝個体情報、通院記録、イベント情報（日付・タイトル）、出力＝カレンダー表示
  - 例外・制約：特になし

- **機能 8：病院マップ機能**
  - 概要：協会提供の病院情報を地図で表示
  - 詳細仕様：協会提供の Google マイマップを埋め込み表示。病院情報を地図上で確認可能
  - 入出力条件：入力＝協会提供の Google マイマップ URL、出力＝マップ埋め込み表示
  - 例外・制約：外部サービス（Google マイマップ）の仕様に依存

- **機能 9：通知機能**
  - 概要：アプリのアップデート情報（お知らせ）やアラート履歴を配信・閲覧
  - 詳細仕様：
    - ユーザー側：ホーム画面ヘッダーの通知アイコン（🔔）から一覧・詳細を閲覧。お知らせとアラートを統合して時系列表示。未読バッジ表示
    - 管理者側：お知らせの新規作成・編集・削除・公開/非公開設定が可能（アラートは自動生成のため管理対象外）
  - 入出力条件：入力＝（管理者）お知らせ投稿、（システム）アラート生成、（ユーザー）閲覧操作、出力＝通知一覧・詳細表示
  - 例外・制約：投稿機能は管理者のみ利用可能

- **機能 10：外部リンク・情報提供機能**
  - 概要：病院情報提供フォーム、協会HP、協会Instagram、お問い合わせ先へのアクセス
  - 詳細仕様：マップ画面から情報提供フォーム（Google フォーム）へ、ホーム画面下部から協会HPリンク、協会Instagramリンクへアクセス可能。お問い合わせ先情報もホーム画面下部に表示。外部リンクは外部ブラウザまたは外部アプリで開く
  - 入出力条件：入力＝各リンクからのアクセス、出力＝外部リンク遷移またはお問い合わせ先情報表示
  - 例外・制約：外部サービス（Google フォーム、協会HP、Instagram）の仕様に依存

- **機能 11：設定機能**
  - 概要：アプリの各種設定を変更・確認
  - 詳細仕様：ホーム画面ヘッダーの設定アイコン（⚙）から設定画面にアクセス可能。飼い主プロフィール編集（表示名・アイコン・性別・年齢・住所）、通知設定（プッシュ通知全体のON/OFF切り替え、およびON時の個別設定としてお世話リマインダー、アラート、管理者からのお知らせの各通知ON/OFFが可能）、利用規約・プライバシーポリシー確認、ログアウト、退会処理が可能
  - 入出力条件：入力＝設定画面での操作、出力＝設定変更反映・各種情報表示
  - 例外・制約：退会・ログアウト処理は確認ダイアログを表示

---

## 5. 非機能要件

- **非機能 1：セキュリティ要件**
  - 概要：ユーザー認証、行レベルセキュリティ（RLS）、個人情報の適切な保護
  - 詳細仕様：Supabase Auth（メール＋パスワード認証）による認証、RLS でデータ分離、個人情報の適切な保護。通信は HTTPS 必須
  - 例外・制約：認証方式はメール＋パスワードのみ（SNS ログインは対象外）

- **非機能 2：可用性要件**
  - 概要：24 時間 365 日の稼働、99%以上の稼働率
  - 詳細仕様：24 時間 365 日の稼働、99%以上の稼働率を目指す
  - 例外・制約：Vercel と Supabase のサービス稼働率に依存

- **非機能 3：UI/UX 要件**
  - 概要：モバイルファースト UI、直感的な操作、見やすいデザイン
  - 詳細仕様：モバイルファースト UI、直感的な操作、見やすいデザイン
  - 例外・制約：デザインはシンプルで使いやすいものを優先

- **非機能 4：パフォーマンス要件**
  - 概要：快適な操作感を実現するためのパフォーマンス目標
  - 詳細仕様：
    - ページ表示：初回ロード時 3 秒以内、ページ遷移時 1 秒以内を目標
    - 画像読み込み：3 秒以内（画像最適化・遅延読み込みを前提）
    - データ取得を含む操作：3 秒以内を目標
  - 例外・制約：
    - ネットワーク環境によっては目標値を下回る場合あり
    - 大量データの集計・分析画面は別途検討

- **非機能 5：保守性要件**
  - 概要：PWA 対応、レスポンシブ対応（スマホ・タブレット・PC）、運用マニュアル提供
  - 詳細仕様：PWA 対応、レスポンシブ対応（スマホ・タブレット・PC）、運用マニュアル提供
  - 例外・制約：運用マニュアルは協会管理者向けのみ

- **非機能 6：データ管理要件**
  - 概要：Supabase 無料枠内での運用、自動バックアップ、可能な限り無料での運用
  - 詳細仕様：Supabase 無料枠内での運用、自動バックアップ利用、可能な限り無料での運用。ログ保存は 30 日（※システムログのみ。ユーザーの健康記録・通院記録等は永続化）
  - 例外・制約：Supabase 無料枠の制限（DB サイズ、同時接続数）に依存

---

## 6. スコープ（今回やること／やらないこと）

- **やること（IN スコープ）**
  - 個体管理、健康記録、通院記録、お世話リマインダー、アラート機能、協会（管理者）用データ閲覧機能、カレンダー機能、病院マップ機能、通知機能、外部リンク・情報提供機能、設定機能
- **やらないこと（OUT スコープ）**
  - アルバム機能
  - オフライン対応
  - App Store / Google Play 配信

---

## 7. 前提条件・制約

- 利用する技術やサービス：Next.js, Supabase, Vercel
- 対象プラットフォーム：スマホブラウザ（PWA）
- 納期：2025/1/21
- その他制約：
  - 予算は無料枠利用、個人開発体制
  - PWA リンク配布（App Store／Google Play は対象外）
  - QR コードでユーザーに案内

---

## 8. リスク・懸念事項

- Supabase 無料枠の制限（DB サイズ、同時接続数）
- 個人開発による工数不足

---

## 9. 用語定義

| 用語     | 定義                                                                       |
| -------- | -------------------------------------------------------------------------- |
| スコープ | プロジェクトで対応する範囲                                                 |
| PWA      | Progressive Web App。インストール不要でアプリのように動作する Web アプリ   |
| RLS      | Row Level Security。ユーザーごとに DB の行レベルでアクセス制御を行う仕組み |
